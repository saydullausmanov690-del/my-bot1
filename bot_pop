from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import Command
import asyncio

TOKEN = "8418792875:AAH6HCuKNcE3dbRaxnvIgdVtIxH6oGwt5Aw"
ADMIN_USERNAME = "@Islompro_maxx"  # Faqat siz koâ€˜rasiz
bot = Bot(token=TOKEN)
dp = Dispatcher()

# --- Klaviatura tugmalari ---
language_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="ğŸ‡ºğŸ‡¿ O'zbekcha"), KeyboardButton(text="ğŸ‡¬ğŸ‡§ English")]
    ],
    resize_keyboard=True,
    one_time_keyboard=True
)

menu_kb_uz = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="ğŸ“¢ Kanal haqida"), KeyboardButton(text="ğŸ¤– Bot haqida")],
        [KeyboardButton(text="ğŸ’» Kod snippetlar"), KeyboardButton(text="ğŸ“ Interaktiv test")],
        [KeyboardButton(text="âš™ï¸ Admin boâ€˜limi"), KeyboardButton(text="â“ Yordam")],
        [KeyboardButton(text="ğŸ›  Bot Code")]
    ],
    resize_keyboard=True
)

menu_kb_en = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="ğŸ“¢ About Channel"), KeyboardButton(text="ğŸ¤– About Bot")],
        [KeyboardButton(text="ğŸ’» Code Snippets"), KeyboardButton(text="ğŸ“ Interactive Quiz")],
        [KeyboardButton(text="âš™ï¸ Admin Panel"), KeyboardButton(text="â“ Help")],
        [KeyboardButton(text="ğŸ›  Bot Code")]
    ],
    resize_keyboard=True
)

back_kb_uz = ReplyKeyboardMarkup(
    keyboard=[[KeyboardButton(text="ğŸ”™ Orqaga")]],
    resize_keyboard=True
)

back_kb_en = ReplyKeyboardMarkup(
    keyboard=[[KeyboardButton(text="ğŸ”™ Back")]],
    resize_keyboard=True
)

# --- /start ---
@dp.message(Command("start"))
async def start(message: types.Message):
    await message.answer("Tilni tanlang / Choose your language:", reply_markup=language_kb)

# --- Barcha tugmalar uchun yagona handler ---
@dp.message()
async def all_handlers(message: types.Message):
    text = message.text

    # Til tanlash
    if text == "ğŸ‡ºğŸ‡¿ O'zbekcha":
        await message.answer("Xush kelibsiz DevStream kanaliga! ğŸ˜Š\nMenu:", reply_markup=menu_kb_uz)
    elif text == "ğŸ‡¬ğŸ‡§ English":
        await message.answer("Welcome to DevStream channel! ğŸ˜Š\nMenu:", reply_markup=menu_kb_en)

    # Kanal haqida
    elif text in ["ğŸ“¢ Kanal haqida", "ğŸ“¢ About Channel"]:
        kanal_text = (
            "ğŸ“¢ **DevStream kanali** â€“ dasturlash va texnologiya olami.\n\n"
            "1. Python asoslari\n2. Python kutubxonalari\n3. JavaScript asoslari\n4. HTML/CSS misollar\n"
            "5. Telegram botlar yaratish\n6. API integratsiyasi\n7. Web scraping misollari\n"
            "8. GUI yaratish (Tkinter, PyQt)\n9. OOP misollari\n10. Machine Learning asoslari\n"
            "11. Data visualization (matplotlib, seaborn)\n12. Docker va virtual muhitlar\n13. Git va GitHub tutoriallar\n"
            "14. Web security asoslari\n15. Foydali resurslar\n\n"
            f"âš ï¸ Nimadur muammo boâ€˜lsa admin bilan bogâ€˜laning: {ADMIN_USERNAME}"
        )
        await message.answer(kanal_text, reply_markup=back_kb_uz if "Kanal" in text else back_kb_en)

    # Bot haqida
    elif text in ["ğŸ¤– Bot haqida", "ğŸ¤– About Bot"]:
        bot_text = (
            "ğŸ¤– **DevStream Bot** â€“ sizga kanal va kodlash boâ€˜yicha maâ€™lumot beradi.\n\n"
            "1. Til tanlash\n2. Kanal va bot haqida batafsil maâ€™lumot\n3. Kod snippetlar\n"
            "4. Interaktiv testlar\n5. Admin boâ€˜limi\n6. Bot Code funksiyasi\n7. Orqaga tugma\n"
            "8. Yordam boâ€˜limi\n9. FAQ boâ€˜limi\n10. Mini-proyektlar\n"
            "11. API misollari\n12. GUI misollari\n13. Web scraping misollari\n"
            "14. Asinxron dasturlash misollari\n15. Foydali cheat sheet lar"
        )
        await message.answer(bot_text, reply_markup=back_kb_uz if "Bot" in text else back_kb_en)

    # Kod snippetlar
    elif text in ["ğŸ’» Kod snippetlar", "ğŸ’» Code Snippets"]:
        await message.answer(
            "**Python misollar:**\n```python\nprint('Hello, DevStream!')\n```\n"
            "```python\nfor i in range(5):\n    print(i)\n```\n"
            "```python\ndef add(a,b):\n    return a+b\n```\n\n"
            "**HTML misollar:**\n```html\n<h1>Welcome</h1>\n<p>Enjoy coding!</p>\n```\n"
            "**JavaScript misollar:**\n```javascript\nconsole.log('Hello, DevStream!');\n```",
            reply_markup=back_kb_uz if "Kod" in text else back_kb_en
        )

    # Interaktiv test
    elif text in ["ğŸ“ Interaktiv test", "ğŸ“ Interactive Quiz"]:
        await message.answer(
            "ğŸ“ **Savol:** Pythonda `print()` nima qiladi?\nA) Matnni ekranga chiqaradi\nB) Fayl ochadi\nC) Raqamlarni qoâ€˜shadi",
            reply_markup=back_kb_uz if "Interaktiv" in text else back_kb_en
        )

    # Admin boâ€˜limi
    elif text in ["âš™ï¸ Admin boâ€˜limi", "âš™ï¸ Admin Panel"]:
        user = message.from_user.username
        if user == "Islompro_maxx":
            await message.answer(
                "âš™ï¸ **Admin boâ€˜limi**\n- Statistikalar\n- Foydalanuvchi xabarlarini koâ€˜rish\n- Muammo yoki shikoyatlarni tekshirish",
                reply_markup=back_kb_uz if "Admin" in text else back_kb_en
            )
        else:
            await message.answer("âš ï¸ Siz admin emassiz!", reply_markup=back_kb_uz if "Admin" in text else back_kb_en)

    # Bot Code
    elif text == "ğŸ›  Bot Code":
        await message.answer(
            "ğŸ›  Har xil botlar kodini sotib olmoqchimisiz?\n"
            f"Unda menga yozing: {ADMIN_USERNAME}",
            reply_markup=back_kb_uz
        )

    # Yordam
    elif text in ["â“ Yordam", "â“ Help"]:
        await message.answer(
            "â“ **Yordam boâ€˜limi:**\n/start â€“ boshlash va til tanlash\nMenu tugmalaridan foydalaning va kerakli boâ€˜limni tanlang.",
            reply_markup=back_kb_uz if "Yordam" in text else back_kb_en
        )

    # Orqaga
    elif text in ["ğŸ”™ Orqaga", "ğŸ”™ Back"]:
        await message.answer("Menu:", reply_markup=menu_kb_uz if "Orqaga" in text else menu_kb_en)

# --- Ishga tushirish ---
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
